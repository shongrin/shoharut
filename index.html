<!DOCTYPE html>
<html dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="Google Sheet.css">
  <title>הזמנת ציוד בה"ד 7</title>
</head>
<body>
<div class="container">
  <form id="product-form" name="contact-form"
      action="https://script.google.com/macros/s/AKfycbwB8B1u2cXS4_N41wf3tz-R8jaSW5x7zRS47yfL4xDOaikunkkVXwN27dZXnuqqB3qr/exec">


    <h4>הזמנת ציוד בה"ד 7</h4>

    <!-- School dropdown -->
    <label for="school">בחר בית ספר:</label>
    <select id="school" name="school">
      <option value="גן יבנה" data-hidden="דרום">גן יבנה</option>
      <option value="מרחבים" data-hidden="דרום">מרחבים</option>
      <option value="אופקים" data-hidden="דרום">אופקים</option>
      <option value="באר שבע" data-hidden="דרום">באר שבע</option>
      <option value="תל אביב" data-hidden="מרכז">תל אביב</option>
      <option value="הרצליה" data-hidden="מרכז">הרצליה</option>
      <option value="רחובות" data-hidden="מרכז">רחובות</option>
      <option value="קריית מוצקין" data-hidden="צפון">קריית מוצקין</option>
    </select>
    <input type="hidden" id="school-region" name="region">

    <!-- Products container -->
    <div id="products-container">
      <div class="product-row">
        <div class="product-header">מוצר חדש</div>
        <div class="product-details">
          <input type="text" name="name" placeholder="שם המזון">
          <input type="text" name="amount" placeholder="כמות">
          <input type="text" name="purpose" placeholder="לאיזה מטרה">
          <div class="date-wrapper">
            <input type="date" name="date">
          </div>
        </div>
      </div>
    </div>

    <!-- Add new product -->
    <button type="button" id="add-product">מוצר נוסף</button>
    <br><br>

    <!-- Submit button -->
    <button type="submit" id="submit">הזמן</button>

  </form>
</div>

<!-- Template for new products -->
<template id="product-template">
  <div class="product-row">
    <div class="product-header">מוצר חדש</div>
    <div class="product-details">
      <input type="text" name="name" placeholder="שם המזון">
      <input type="text" name="amount" placeholder="כמות">
      <input type="text" name="purpose" placeholder="לאיזה מטרה">
      <div class="date-wrapper">
        <input type="date" name="date">
      </div>
    </div>
  </div>
</template>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById('product-form');
  const schoolSelect = document.getElementById('school');
  const regionInput = document.getElementById('school-region');
  const container = document.getElementById('products-container');
  const addButton = document.getElementById('add-product');
  const template = document.getElementById('product-template');

  // Collapse/expand product rows
  container.addEventListener('click', e => {
    const header = e.target.closest('.product-header');
    if (!header) return;
    const row = header.closest('.product-row');
    row.classList.toggle('collapsed');
  });

  // Setup a row: live update header
  function setupRow(row) {
    const header = row.querySelector('.product-header');
    const input = row.querySelector('input[name="name"]');
    if (!header || !input) return;

    input.addEventListener('input', () => {
      header.textContent = input.value.trim() || 'מוצר חדש';
    });
  }

  // Initialize first row
  container.querySelectorAll('.product-row').forEach(setupRow);

  // Add new product row
  addButton.addEventListener('click', () => {
    const rows = container.querySelectorAll('.product-row');
    const lastRow = rows[rows.length - 1];

    // Collapse previous row and set header to food name
    const input = lastRow.querySelector('input[name="name"]');
    const header = lastRow.querySelector('.product-header');
    if (input && header) {
      header.textContent = input.value.trim() || 'מוצר חדש';
    }
    lastRow.classList.add('collapsed');

    // Clone template
    const cloneFragment = template.content.cloneNode(true);
    const newRow = cloneFragment.querySelector('.product-row');
    container.appendChild(newRow);
    setupRow(newRow);

    // Focus on first input of new row
    const firstInput = newRow.querySelector('input[name="name"]');
    if (firstInput) firstInput.focus();
  });

  // Handle form submission
  form.addEventListener('submit', e => {
    e.preventDefault();

    regionInput.value = schoolSelect.selectedOptions[0].dataset.hidden;

    // Collect all products
    const rows = container.querySelectorAll('.product-row');
    const products = [];
    rows.forEach(row => {
      const name = row.querySelector('input[name="name"]').value;
      const amount = row.querySelector('input[name="amount"]').value;
      const purpose = row.querySelector('input[name="purpose"]').value;
      const date = row.querySelector('input[name="date"]').value;
      products.push({ name, amount, purpose, date });
    });

    // Send to Google Apps Script as JSON
    const formData = new FormData();
    formData.append('school', schoolSelect.value);
    formData.append('region', regionInput.value);
    formData.append('products', JSON.stringify(products));

    fetch(form.action, { method: 'POST', body: formData })
      .then(res => res.json())
      .then(data => alert(data.message || "נשלח בהצלחה"))
      .catch(err => console.error(err));
  });
});
</script>
</body>
</html>



