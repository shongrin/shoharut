<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Google Sheet.css">
</head>
<body>
    <div class="container">
        <form method="post" 
              action="https://script.google.com/macros/s/AKfycbxTEINIbWjvY5af8J2TcTSpEa8JAMBMpGSGIsEB9Fg/dev" 
              name="contact-form">

            <h4>הזמנת ציוד בה"ד 7</h4>

            <!-- School dropdown -->
            <label for="school">בחר בית ספר:</label>
            <select id="school" name="שם בית ספר">
                <option value="גן יבנה" data-hidden="דרום">גן יבנה</option>
                <option value="מרחבים" data-hidden="דרום">מרחבים</option>
                <option value="אופקים" data-hidden="דרום">אופקים</option>
                <option value="באר שבע" data-hidden="דרום">באר שבע</option>
                <option value="תל אביב" data-hidden="מרכז">תל אביב</option>
                <option value="הרצליה" data-hidden="מרכז">הרצליה</option>
                <option value="רחובות" data-hidden="מרכז">רחובות</option>
                <option value="קריית מוצקין" data-hidden="צפון">קריית מוצקין</option>
            </select>
            <input type="hidden" name="מחוז" id="school-region">

            <script>
            document.addEventListener("DOMContentLoaded", () => {
                const form = document.querySelector('form[name="contact-form"]');
                const select = document.getElementById('school');
                const hidden = document.getElementById('school-region');

                form.addEventListener('submit', function() {
                    hidden.value = select.options[select.selectedIndex].dataset.hidden;
                });
            });
            </script>

            <!-- Products container -->
            <div id="products-container">
                <div class="input-row product-row">
                    <div class="product-header">
                        מוצר חדש
                    </div>
                    <div class="product-details">
                        <input type="text" name="מזון[]" placeholder="שם המזון">
                        <input type="text" name="כמות[]" placeholder="כמות">
                        <input type="text" name="מטרה[]" placeholder="לאיזה מטרה">
                        <div class="date-wrapper">
                            <input type="date" name="תאריך קבלה[]">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add another product button -->
            <button type="button" id="add-product">מוצר נוסף</button>
            <br><br>

            <!-- Submit button -->
            <input type="submit" value="הזמן" id="submit">
        </form>
    </div>

<script src="Google Sheet.js"></script>

<!-- Collapsible + add-row logic -->
<script>
document.addEventListener("DOMContentLoaded", () => {

    const container = document.getElementById('products-container');
    const addButton = document.getElementById('add-product');

    // HEADER CLICK COLLAPSE USING CLASS
    container.addEventListener('click', (e) => {
        const header = e.target.closest('.product-header');
        if (!header) return;
        const row = header.closest('.product-row');
        row.classList.toggle('collapsed');
    });

    // Setup row (header text + typing update)
    function setupRow(row) {
        const header = row.querySelector('.product-header');
        const nameInput = row.querySelector('input[name="מזון[]"]');

        if (!header || !nameInput) return;

        // Initial header
        const initial = nameInput.value.trim();
        header.textContent = initial || "מוצר חדש";

        if (row.dataset.init === "1") return;
        row.dataset.init = "1";

        // Live header update
        nameInput.addEventListener("input", () => {
            const val = nameInput.value.trim();
            header.textContent = val || "מוצר חדש";
        });
    }

    // Add new product
    addButton.addEventListener('click', () => {
        const rows = [...container.querySelectorAll('.product-row')];
        const first = rows[0];

        // Collapse ALL existing rows
        rows.forEach(r => r.classList.add('collapsed'));

        // Clone
        const newRow = first.cloneNode(true);

        // Reset inputs
        newRow.querySelectorAll("input").forEach(i => i.value = "");

        // Expand new row
        newRow.classList.remove('collapsed');

        // Reset header
        newRow.querySelector(".product-header").textContent = "מוצר חדש";

        container.appendChild(newRow);

        // Setup logic for the new row
        setupRow(newRow);

        newRow.scrollIntoView({ behavior: "smooth", block: "center" });
    });

    // Initialize first row
    const firstRow = container.querySelector(".product-row");
    firstRow.classList.remove("collapsed");
    setupRow(firstRow);

});
</script>

</body>
</html>
